# 会话列表模块测试用例

> **测试类型**: 黑盒测试  
> **测试环境**: iOS / Android 真机  
> **测试范围**: 会话列表页面 (`conversationList.nvue`) 及其子组件

---

## 一、UI/布局渲染测试

| 用例编号 | 模块/组件 | 测试项 | 前置条件 | 操作步骤 | 预期结果 (强调原生体验) | 优先级 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| UI-001 | conversationList | 页面首次加载渲染 | 用户已登录，有会话数据 | 1. 从其他页面跳转到会话列表页 | 页面无白屏、无闪烁，导航栏、搜索栏、会话列表同时渲染完成，无"渲染一半"现象 | P0 |
| UI-002 | conversationList | 刘海屏/动态岛适配 | iOS 设备（含 iPhone X 及以上） | 1. 进入会话列表页<br>2. 观察导航栏区域 | 导航栏正确避开刘海/动态岛区域，标题"消息"完整显示，右上角加号按钮可点击 | P0 |
| UI-003 | conversationList | Android 异形屏适配 | Android 设备（含挖孔屏、水滴屏） | 1. 进入会话列表页<br>2. 观察顶部状态栏和导航栏 | 状态栏颜色与页面协调，导航栏内容不被遮挡，布局正常 | P0 |
| UI-004 | CustomNavbar | 导航栏布局 | 进入会话列表页 | 1. 观察导航栏<br>2. 检查返回按钮、标题、右侧加号图标 | 返回按钮居左，标题"消息"居中，加号图标居右，间距合理，图标清晰无模糊 | P1 |
| UI-005 | 搜索入口 | 搜索栏样式 | 进入会话列表页 | 1. 观察搜索入口区域 | 搜索栏背景色为 #F0F2F7，圆角 8rpx，搜索图标和"搜索"占位文字水平垂直居中 | P1 |
| UI-006 | ConversationPreview | 会话项布局 | 存在多个会话 | 1. 观察单个会话项的布局 | 头像居左 (圆形)，右侧依次为会话名称、时间、最后一条消息、免打扰图标，各元素对齐无错位 | P0 |
| UI-007 | ConversationPreview | 会话名称截断 | 存在会话名称超长的会话 (如群名 30+ 字符) | 1. 观察该会话项 | 会话名称单行显示，超长部分以省略号 (…) 截断，不换行，不溢出 | P1 |
| UI-008 | ConversationPreview | 最后一条消息截断 | 存在最后一条消息超长的会话 | 1. 观察该会话项的消息摘要 | 消息摘要单行显示，超过 15 字符后以 "..." 截断，表情图片正常显示 | P1 |
| UI-009 | ConversationPreview | 置顶会话样式 | 存在置顶会话 | 1. 观察置顶会话项 | 置顶会话背景色为 #F0F2F7，与普通会话 (#FFFFFF) 明显区分 | P1 |
| UI-010 | ConversationPreview | 免打扰图标显示 | 存在设置免打扰的会话 | 1. 观察该会话项右下角 | 显示静音图标 (mute.png)，图标清晰，位置在时间下方 | P1 |
| UI-011 | ConversationPreview | 未读消息红点 | 存在未读消息的会话 | 1. 观察头像右上角 | 显示红色未读数角标，数字清晰可读；若免打扰则显示红点而非数字 | P0 |
| UI-012 | ConversationPreview | 草稿标识 | 存在草稿的会话 | 1. 观察该会话项消息摘要 | 消息摘要前显示红色 "[草稿]" 标签，后跟草稿内容 | P1 |
| UI-013 | ConversationPreview | 表情消息显示 | 最后一条消息包含表情 | 1. 观察消息摘要区域 | 表情以图片形式内联显示，尺寸 32rpx，与文字垂直对齐 | P1 |
| UI-014 | ConversationPreview | 时间格式显示 | 存在不同时间的会话 | 1. 观察今天、昨天、本周、今年、去年的会话时间 | 今天显示 "HH:mm"，昨天显示 "昨天 HH:mm"，本周显示 "周X HH:mm"，今年显示 "MM/DD"，去年显示 "YYYY/MM/DD" | P1 |
| UI-015 | menu-popup | 弹出菜单样式 | 进入会话列表页 | 1. 点击右上角加号 | 弹出菜单从右上角出现，有白色背景、圆角 12px、阴影效果，顶部有小三角箭头指向加号 | P1 |
| UI-016 | menu-popup | 弹出菜单内容 | 弹出菜单已显示 | 1. 观察菜单项 | 显示"发起单聊"和"创建群聊"两个选项，各有图标和文字，间距合理 | P1 |
| UI-017 | ConversationActions | 滑动操作按钮样式 | 存在会话 | 1. 左滑某个会话项 | 显示操作按钮区域，默认显示"免打扰"(蓝色)、"置顶"(橙色)、"删除"(红色) 三个按钮，颜色鲜明 | P0 |
| UI-018 | placeholders | 空列表占位图 | 用户无任何会话 | 1. 进入会话列表页 | 页面中央显示"暂无会话"文字，字体 28rpx，颜色 #999999 | P1 |
| UI-019 | placeholders | 加载中占位图 | 首次加载数据中 | 1. 观察页面 | 显示"加载中..."文字，居中显示 | P2 |
| UI-020 | placeholders | 加载失败占位图 | 网络异常导致加载失败 | 1. 断网后进入会话列表页 | 显示红色"加载失败"文字及错误信息 | P1 |

---

## 二、功能交互测试

| 用例编号 | 模块/组件 | 测试项 | 前置条件 | 操作步骤 | 预期结果 (强调原生体验) | 优先级 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| FUNC-001 | CustomNavbar | 返回按钮功能 | 从其他页面进入会话列表 | 1. 点击左上角返回按钮 | 页面返回上一级，转场动画流畅，无卡顿 | P0 |
| FUNC-002 | CustomNavbar | 菜单按钮点击 | 进入会话列表页 | 1. 点击右上角加号按钮 | 弹出菜单显示，再次点击关闭菜单 | P0 |
| FUNC-003 | menu-popup | 点击遮罩关闭 | 弹出菜单已显示 | 1. 点击菜单外的遮罩区域 | 菜单关闭，不触发其他操作 | P1 |
| FUNC-004 | menu-popup | 发起单聊 | 弹出菜单已显示 | 1. 点击"发起单聊" | 菜单关闭，跳转到 userPicker 页面 (businessType=1)，转场流畅 | P0 |
| FUNC-005 | menu-popup | 创建群聊 | 弹出菜单已显示 | 1. 点击"创建群聊" | 菜单关闭，跳转到 userPicker 页面 (businessType=2)，转场流畅 | P0 |
| FUNC-006 | 搜索入口 | 搜索入口点击 | 进入会话列表页 | 1. 点击搜索栏 | 跳转到搜索页面，转场动画流畅无白屏 | P0 |
| FUNC-007 | ConversationList | 会话点击跳转 | 存在会话 | 1. 点击某个会话项 | 跳转到聊天页面，携带正确的 conversationID 参数，转场流畅 | P0 |
| FUNC-008 | ConversationList | 点击清除未读数 | 存在有未读消息的会话 | 1. 点击该会话 | 未读数角标消失，同时跳转到聊天页 | P0 |
| FUNC-009 | SwipeActions | 左滑显示操作 | 存在会话 | 1. 在会话项上从右向左滑动 | 会话项向左滑动，露出右侧操作按钮区域，动画跟手流畅 | P0 |
| FUNC-010 | SwipeActions | 滑动后点击内容区 | 已左滑显示操作按钮 | 1. 点击会话内容区域 (非操作按钮) | 操作按钮收起，不跳转聊天页 (交互对齐企微) | P1 |
| FUNC-011 | SwipeActions | 滑动互斥 | 已左滑显示 A 会话的操作按钮 | 1. 左滑 B 会话 | A 会话的操作按钮自动收起，B 会话的操作按钮显示 | P1 |
| FUNC-012 | ConversationActions | 置顶会话 | 存在未置顶的会话 | 1. 左滑会话<br>2. 点击"置顶"按钮 | 会话移动到列表顶部，背景色变为 #F0F2F7，操作按钮收起 | P0 |
| FUNC-013 | ConversationActions | 取消置顶 | 存在已置顶的会话 | 1. 左滑该会话<br>2. 点击"取消置顶"按钮 | 会话按时间排序回到正常位置，背景色恢复为白色 | P0 |
| FUNC-014 | ConversationActions | 设置免打扰 | 存在未免打扰的会话 | 1. 左滑会话<br>2. 点击"免打扰"按钮 | 会话项右下角显示静音图标，未读数变为红点显示，操作按钮收起 | P0 |
| FUNC-015 | ConversationActions | 取消免打扰 | 存在已免打扰的会话 | 1. 左滑该会话<br>2. 点击"取消免打扰"按钮 | 静音图标消失，未读数恢复数字显示 | P0 |
| FUNC-016 | ConversationActions | 删除会话 | 存在会话 | 1. 左滑会话<br>2. 点击"删除"按钮 | 会话从列表中移除，无确认弹窗 (当前逻辑)，列表刷新无闪烁 | P0 |
| FUNC-017 | ConversationActions | 操作失败提示 | 网络异常 | 1. 断网<br>2. 左滑会话并点击"置顶" | 显示 Toast 提示"置顶失败"，操作按钮收起 | P1 |
| FUNC-018 | ConversationList | 列表滚动 | 会话数量超过一屏 | 1. 上下滑动列表 | 滚动流畅，无卡顿，无滚动条显示 (show-scrollbar=false) | P0 |
| FUNC-019 | ConversationList | 列表滚动穿透 | 弹出菜单显示时 | 1. 点击加号显示菜单<br>2. 尝试滑动背景列表 | 列表不滚动，触摸事件被遮罩拦截 | P1 |

---

## 三、网络与数据测试

| 用例编号 | 模块/组件 | 测试项 | 前置条件 | 操作步骤 | 预期结果 (强调原生体验) | 优先级 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| DATA-001 | ConversationList | 空数据状态 | 新用户无任何会话 | 1. 进入会话列表页 | 显示空列表占位图"暂无会话"，不显示列表组件 | P0 |
| DATA-002 | ConversationList | 数据加载中状态 | 首次进入页面 | 1. 观察页面加载过程 | 显示"加载中..."占位图，数据加载完成后切换为列表 | P1 |
| DATA-003 | ConversationList | 网络异常加载失败 | 断开网络 | 1. 断网后进入会话列表页 | 显示"加载失败"占位图及错误信息 | P1 |
| DATA-004 | ConversationList | 弱网环境加载 | 模拟弱网 (3G/2G) | 1. 进入会话列表页 | 显示加载中状态，数据加载完成后正常显示，无崩溃 | P1 |
| DATA-005 | ConversationList | 实时消息更新 | 已在会话列表页 | 1. 其他设备发送新消息 | 对应会话的最后一条消息更新，未读数增加，会话排序可能变化 (按时间) | P0 |
| DATA-006 | ConversationList | 新会话实时添加 | 已在会话列表页 | 1. 其他用户首次发起会话 | 新会话出现在列表中，无需手动刷新 | P0 |
| DATA-007 | ConversationPreview | 各类消息摘要 | 存在不同类型最后消息的会话 | 1. 观察图片/视频/语音/文件/表情/自定义消息的摘要 | 分别显示 "[图片]"、"[视频]"、"[语音]"、"[文件] 文件名"、"[表情]"、"[自定义消息]" 或描述 | P1 |
| DATA-008 | ConversationPreview | 撤回消息摘要 | 最后一条消息被撤回 | 1. 观察该会话摘要 | 显示 "[消息已撤回]" | P1 |
| DATA-009 | ConversationPreview | 群聊消息发送者 | 群聊最后一条消息为文本 | 1. 观察消息摘要 | 显示 "发送者名称: 消息内容"，自己发送显示 "我: 消息内容" | P1 |
| DATA-010 | ConversationList | 会话排序 | 存在多个会话 | 1. 观察列表顺序 | 置顶会话在最上方，非置顶会话按最后消息时间倒序排列 | P0 |

---

## 四、性能与兼容性测试

| 用例编号 | 模块/组件 | 测试项 | 前置条件 | 操作步骤 | 预期结果 (强调原生体验) | 优先级 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| PERF-001 | ConversationList | 长列表滚动帧率 | 会话数量 100+ | 1. 快速上下滑动列表<br>2. 观察滚动流畅度 | 滚动帧率接近 60fps，无明显卡顿或掉帧，原生 list 组件渲染 | P0 |
| PERF-002 | ConversationList | 大量数据首屏渲染 | 会话数量 500+ | 1. 进入会话列表页<br>2. 记录首屏渲染时间 | 首屏在 1 秒内渲染完成，使用 cell 复用机制 | P1 |
| PERF-003 | conversationList | 页面切换内存 | 正常使用状态 | 1. 反复进入/退出会话列表页 10 次<br>2. 观察 App 内存占用 | 内存无持续增长，无内存泄漏 (onBeforeUnmount 正确销毁 Store) | P1 |
| PERF-004 | SwipeActions | 滑动动画性能 | 存在会话 | 1. 快速左滑多个会话 | 滑动动画流畅跟手，无延迟或卡顿 | P1 |
| PERF-005 | conversationList | 页面转场性能 | 在会话列表页 | 1. 点击会话跳转聊天页<br>2. 返回会话列表 | 转场动画流畅，无白屏、无闪烁，返回时列表状态保持 | P0 |
| PERF-006 | menu-popup | 弹窗动画性能 | 在会话列表页 | 1. 快速多次点击加号按钮 | 菜单显示/隐藏响应及时，无延迟或动画卡顿 | P2 |
| COMPAT-001 | conversationList | iOS 低版本兼容 | iOS 12+ 设备 | 1. 完整操作所有功能 | 所有功能正常，布局无异常 | P1 |
| COMPAT-002 | conversationList | Android 低版本兼容 | Android 7.0+ 设备 | 1. 完整操作所有功能 | 所有功能正常，布局无异常 | P1 |
| COMPAT-003 | ConversationPreview | iOS/Android 字体渲染差异 | 分别在 iOS 和 Android 测试 | 1. 对比会话名称、时间、消息摘要的字体显示 | 两端字体清晰可读，行高一致，无明显差异导致的布局错乱 | P1 |
| COMPAT-004 | ConversationList | 横竖屏切换 | 支持横屏的设备 | 1. 切换到横屏<br>2. 切换回竖屏 | 布局自适应，无错位或溢出，列表正常显示 | P2 |
| COMPAT-005 | ConversationPreview | 深色模式 | 系统开启深色模式 | 1. 进入会话列表页 | (如支持) 颜色适配深色模式；(如不支持) 保持浅色主题，无异常 | P2 |

---

## 五、边界与异常测试

| 用例编号 | 模块/组件 | 测试项 | 前置条件 | 操作步骤 | 预期结果 (强调原生体验) | 优先级 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| EDGE-001 | ConversationPreview | 头像加载失败 | 会话头像 URL 无效 | 1. 观察该会话头像 | 显示默认头像 (根据会话类型区分用户/群组) | P1 |
| EDGE-002 | ConversationPreview | 超长未读数 | 未读消息数 999+ | 1. 观察头像角标 | 显示 "99+" 或类似截断，不溢出头像区域 | P1 |
| EDGE-003 | ConversationPreview | 特殊字符会话名 | 会话名包含 emoji、特殊符号 | 1. 观察会话名称显示 | 正确显示特殊字符，无乱码或渲染异常 | P1 |
| EDGE-004 | ConversationList | 快速连续操作 | 存在会话 | 1. 快速连续点击多个会话 | 只响应第一次点击，不重复跳转，无崩溃 | P1 |
| EDGE-005 | SwipeActions | 滑动边界 | 存在会话 | 1. 尝试向右滑动会话项 | 无响应或弹回，不显示左侧操作区 | P2 |
| EDGE-006 | ConversationActions | 快速连续点击操作按钮 | 已左滑显示操作按钮 | 1. 快速连续点击"删除"按钮 | 只执行一次删除操作，无重复请求 | P1 |
| EDGE-007 | menu-popup | 菜单显示时返回 | 弹出菜单已显示 | 1. 按系统返回键 (Android) 或左滑返回 (iOS) | 菜单关闭，不返回上一页 | P1 |
| EDGE-008 | ConversationList | 组件销毁清理 | 在会话列表页 | 1. 跳转到其他页面<br>2. 返回会话列表 | Store 正确销毁和重建，无内存泄漏，数据正常加载 | P1 |

---

## 测试环境建议

| 设备类型 | 推荐机型 | 系统版本 |
| :--- | :--- | :--- |
| iOS 刘海屏 | iPhone 14 Pro (动态岛) | iOS 16+ |
| iOS 非刘海屏 | iPhone SE 3 | iOS 15+ |
| Android 高端 | 小米 14 / 华为 Mate 60 | Android 13+ |
| Android 中端 | Redmi Note 12 | Android 12 |
| Android 低端 | 红米 9A | Android 10 |

---

## 测试数据准备

1. **空数据账号**: 新注册用户，无任何会话
2. **少量数据账号**: 5-10 个会话，包含 C2C 和群聊
3. **大量数据账号**: 100+ 会话，用于性能测试
4. **特殊数据账号**:
   - 包含超长群名 (30+ 字符) 的群聊
   - 包含 emoji 表情名称的会话
   - 包含草稿的会话
   - 包含免打扰设置的会话
   - 包含置顶的会话
   - 包含 999+ 未读消息的会话
   - 最后消息为各类型 (图片/视频/语音/文件/表情/自定义) 的会话
