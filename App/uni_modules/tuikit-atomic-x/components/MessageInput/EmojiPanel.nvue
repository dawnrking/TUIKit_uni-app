<template>
  <view class="emoji-panel">
    <list class="emoji-list" :show-scrollbar="false">
      
      <cell
        v-for="(row, rowIndex) in chunkedEmojiList"
        :key="rowIndex"
        class="emoji-cell"
      >
        <view class="emoji-row">
          <view 
            v-for="(emoji, colIndex) in row" 
            :key="colIndex"
            class="emoji-item"
            @click="handleEmojiTap(emoji)"
          >
            <text class="emoji-text">{{ emoji.key || emoji }}</text>
          </view>
        </view>
      </cell>
      
      <cell>
        <view style="height: 40rpx;"></view>
      </cell>
    </list>
  </view>
</template>

<script setup>
import { computed } from 'vue';

const emit = defineEmits(['select']);

const COLUMNS = 8; // æ¯ä¸€è¡Œæ˜¾ç¤ºçš„ä¸ªæ•°

// é»˜è®¤æ•°æ®
const DEFAULT_EMOJIS = [
  'ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ¤£', 'ğŸ˜‚',
  'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ¥°', 'ğŸ˜', 'ğŸ¤©',
  'ğŸ˜˜', 'ğŸ˜—', 'â˜ºï¸', 'ğŸ˜š', 'ğŸ˜™', 'ğŸ˜‹', 'ğŸ˜›',
  'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ˜', 'ğŸ¤‘', 'ğŸ¤—', 'ğŸ¤­', 'ğŸ¤«', 'ğŸ¤”',
  'ğŸ¤', 'ğŸ¤¨', 'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜¶', 'ğŸ˜', 'ğŸ˜’', 'ğŸ™„',
  'ğŸ˜¬', 'ğŸ¤¥', 'ğŸ˜Œ', 'ğŸ˜”', 'ğŸ˜ª', 'ğŸ¤¤', 'ğŸ˜´', 'ğŸ˜·',
  'ğŸ¤’', 'ğŸ¤•', 'ğŸ¤¢', 'ğŸ¤®', 'ğŸ¤§', 'ğŸ¥µ', 'ğŸ¥¶', 'ğŸ¥´',
  'ğŸ˜µ', 'ğŸ¤¯', 'ğŸ¤ ', 'ğŸ¥³', 'ğŸ˜ ', 'ğŸ˜', 'ğŸ¤“', 'ğŸ§',
  'ğŸ˜•', 'ğŸ˜Ÿ', 'ğŸ™', 'â˜¹ï¸', 'ğŸ˜®', 'ğŸ˜¯', 'ğŸ˜²', 'ğŸ˜³',
  'ğŸ¥º', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜¨', 'ğŸ˜°', 'ğŸ˜¥', 'ğŸ˜¢', 'ğŸ˜­',
  'ğŸ˜±', 'ğŸ˜–', 'ğŸ˜£', 'ğŸ˜', 'ğŸ˜“', 'ğŸ˜©', 'ğŸ˜«', 'ğŸ¥±',
  'ğŸ˜¤', 'ğŸ˜¡', 'ğŸ¤¬', 'ğŸ˜ˆ', 'ğŸ‘¿', 'ğŸ’€', 'â˜ ï¸',
  'ğŸ¤¡', 'ğŸ‘¹', 'ğŸ‘º', 'ğŸ‘»', 'ğŸ‘½', 'ğŸ‘¾', 'ğŸ¤–',
  'ğŸ˜º', 'ğŸ˜¸', 'ğŸ˜¹', 'ğŸ˜»', 'ğŸ˜¼', 'ğŸ˜½', 'ğŸ™€', 'ğŸ˜¿',
  'ğŸ˜¾', 'ğŸ™ˆ', 'ğŸ™‰', 'ğŸ™Š', 'ğŸ’‹', 'ğŸ’Œ', 'ğŸ’˜', 'ğŸ’',
  'ğŸ’–', 'ğŸ’—', 'ğŸ’“', 'ğŸ’', 'ğŸ’•', 'ğŸ’Ÿ', 'â£ï¸', 'ğŸ’”',
];

// 1. å…ˆæ ‡å‡†åŒ–æ•°æ®æ ¼å¼
const normalizedList = computed(() => {
  return DEFAULT_EMOJIS.map(e => ({ key: e })); // ç»Ÿä¸€è½¬å¯¹è±¡ï¼Œæ–¹ä¾¿æ‰©å±•
});

// 2. æ ¸å¿ƒç®—æ³•ï¼šå°†ä¸€ç»´æ•°ç»„åˆ‡ç‰‡æˆäºŒç»´æ•°ç»„
// [a,b,c...] -> [[a,b,c,d,e,f,g,h], [i...]]
const chunkedEmojiList = computed(() => {
  const result = [];
  const list = normalizedList.value;
  const len = list.length;
  
  for (let i = 0; i < len; i += COLUMNS) {
    // æˆªå–ä¸€è¡Œçš„æ®
    result.push(list.slice(i, i + COLUMNS));
  }
  return result;
});

const handleEmojiTap = (emoji) => {
  emit('select', emoji);
};
</script>

<style scoped>
.emoji-panel {
  flex: 1;
  background-color: #fff;
  padding-top: 23rpx;
  padding-bottom: 23rpx;
  /* é˜²æ­¢æŒ‚è½½æ—¶çš„éšå¼åŠ¨ç”» */
  transform: translateY(0);
}

.emoji-list {
  flex: 1;
  /* nvue ä¸­ list é»˜è®¤å°±ä¼šæ’‘æ»¡çˆ¶å®¹å™¨ï¼Œä½†æ˜¾å¼å†™ä¸€ä¸‹æ›´å®‰å…¨ */
}

/* Cell æ ·å¼ 
  æ³¨æ„ï¼šnvue ä¸­ cell ä¸æ”¯æŒ marginï¼Œåªèƒ½ç”¨å†…éƒ¨ view çš„ padding/margin æ¥æ§åˆ¶é—´è·
*/
.emoji-cell {
  background-color: #fff;
}

/* æ¯ä¸€è¡Œçš„å®¹å™¨ */
.emoji-row {
  flex-direction: row;       /* å¿…é¡»æ˜¾å¼å£°æ˜æ¨ªå‘æ’åˆ— */
  padding-left: 48rpx;       /* æ•´ä½“å·¦è¾¹è· */
  padding-right: 48rpx;      /* æ•´ä½“å³è¾¹è· */
  height: 104rpx;            /* ç»™æ¯ä¸€è¡Œå®šé«˜ï¼Œæ€§èƒ½æœ€å¥½ */
  align-items: center;       /* å‚ç›´å±…ä¸­ */
  justify-content: space-around; /* å·¦å¯¹é½ï¼Œé˜²æ­¢æœ€åä¸€è¡Œå…ƒç´ è¢«æ‹‰ä¼¸æˆ–ä¸¤ç«¯å¯¹é½ */
}

/* å•ä¸ªè¡¨æƒ…å®¹å™¨ */
.emoji-item {
  width: 60rpx;             /* å›ºå®šå®½åº¦ */
  height: 60rpx;
  margin-right: 8rpx;       /* item ä¹‹é—´çš„é—´è· */
  justify-content: center;
  align-items: center;
  border-radius: 8rpx;
}

/* ç‚¹å‡»æ€ (Active State) */
.emoji-item:active {
  background-color: #e0e0e0;
}

.emoji-text {
  font-size: 52rpx;
  font-family: sans-serif; /* ç¡®ä¿ Emoji æ¸²æŸ“æ­£å¸¸ */
}
</style>